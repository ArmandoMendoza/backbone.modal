(function(){var t={}.hasOwnProperty,e=function(e,i){function n(){this.constructor=e}for(var o in i)t.call(i,o)&&(e[o]=i[o]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e},i=[].indexOf||function(t){for(var e=0,i=this.length;i>e;e++)if(e in this&&this[e]===t)return e;return-1};if("undefined"==typeof Backbone||null===Backbone)throw Error("Backbone is not defined. Please include the latest version from http://documentcloud.github.com/backbone/backbone.js");Backbone.Modal=function(t){function n(){var t;t=Array.prototype.slice.apply(arguments),Backbone.View.prototype.constructor.apply(this,t),this.setUIElements(),this.delegateModalEvents()}return e(n,t),n.prototype.render=function(){var t;return t=this.serializeData(),this.$el.addClass("bb-modal"),this.template&&this.$el.html(this.template(t)),this.viewContainer&&this.$(this.viewContainer).addClass("bb-modal-views"),this.$el.show(),this.openAt(0),this},n.prototype.setUIElements=function(){var t;if(this.template=this.getOption("template"),this.views=this.getOption("views"),null!=(t=this.views)&&(t.length=_.size(this.views)),this.viewContainer=this.getOption("viewContainer"),this.$el.hide(),_.isUndefined(this.template)&&_.isUndefined(this.views))throw Error("No template or views defined for Backbone.Modal");if(this.template&&this.views&&_.isUndefined(this.viewContainer))throw Error("No viewContainer defined for Backbone.Modal")},n.prototype.getOption=function(t){return t?this.options&&i.call(this.options,t)>=0&&null!=this.options[t]?this.options[t]:this[t]:void 0},n.prototype.serializeData=function(){var t;return t={},this.model?t=this.model.toJSON():this.collection&&(t={items:this.collection.toJSON()}),t},n.prototype.delegateModalEvents=function(){var t,e,i,n,o,r,s,h=this;t=this.getOption("cancelEl"),o=this.getOption("submitEl"),o&&this.$el.on("click",o,function(t){return h.triggerSubmit(t)}),t&&this.$el.on("click",t,function(t){return h.triggerCancel(t)}),$("body").on("keyup",function(t){return h.checkKey(t)}),s=[];for(e in this.views)"length"!==e?(i=e.match(/^(\S+)\s*(.*)$/),r=i[1],n=i[2],s.push(this.$el.on(r,n,this.views[e],function(t){return h.triggerView(t)}))):s.push(void 0);return s},n.prototype.checkKey=function(t){switch(t.keyCode){case 27:return this.triggerCancel();case 13:return this.triggerSubmit()}},n.prototype.buildView=function(t){var e,i;if(t)return _.isFunction(t)?(e=this.serializeData(),new t instanceof Backbone.View?(i=new t(e),{el:i.$el,view:i}):{el:t(e)}):{view:t,el:t.$el}},n.prototype.triggerView=function(t){var e,i;return null!=t&&"function"==typeof t.preventDefault&&t.preventDefault(),i=t.data,e=this.buildView(i.view),this.currentView=e.view,this.viewContainer?this.$(this.viewContainer).html(e.el):this.$el.html(e.el)},n.prototype.triggerSubmit=function(t){return null!=t&&t.preventDefault(),this.beforeSubmit&&this.beforeSubmit()===!1?void 0:("function"==typeof this.submit&&this.submit(),this.close())},n.prototype.triggerCancel=function(t){return null!=t&&t.preventDefault(),this.beforeCancel&&this.beforeCancel()===!1?void 0:("function"==typeof this.cancel&&this.cancel(),this.close())},n.prototype.close=function(){var t,e=this;return $("body").off("keyup",function(t){return e.checkKey(t)}),null!=(t=this.currentView)&&"function"==typeof t.remove&&t.remove(),this.remove()},n.prototype.openAt=function(t){var e,i,n;e=0;for(i in this.views)"length"!==i&&(e===t&&(n=this.views[i]),e++);return n&&(this.currentIndex=t,this.triggerView({data:n})),this},n.prototype.next=function(){return this.currentIndex+1<this.views.length-1?this.openAt(this.currentIndex+1):void 0},n.prototype.previous=function(){return this.currentIndex-1<this.views.length-1?this.openAt(this.currentIndex-1):void 0},n.prototype.animate=function(){},n}(Backbone.View)}).call(this);